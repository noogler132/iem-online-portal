var authbox = require('./');

authbox.configure({
  apiKey: 'authboxTesting',
  secretKey: '37b4a22f6101e62123856301c659a999',
  endpoint: 'http://localhost:3000/api',
  getRequestData: function(req, cb) {
    cb(null, {
      $user: {
        $userIDs: [{$type: '$email', $key: 'foo@bar.com'}]
      }
    });
  }
});

var express = require('express');
var app = express();

app.use(authbox.middleware);
app.set('trust proxy', true);

app.get('/', function(req, res) {
  res.send('<html><body>Hello World!</body></html>');
});

app.get('/custom', function(req, res) {
  authbox.check(req, {$actionType: 'custom'}, function(verdict) {
    res.send('<html><body>Hello World! ' + JSON.stringify(verdict)  + '</body></html>');
  });
});

var server = app.listen(8888, function() {
  var host = server.address().address;
  var port = server.address().port;
  console.log('Example app listening at http://%s:%s', host, port);
});
