'use strict';
function runGrip(src, srcKey, grip) {
  var destValue = null;

  if (typeof grip === 'function') {
    destValue = grip(src[srcKey], srcKey);
  } else if (typeof grip === 'string') {
    destValue = src[srcKey][grip];
    if (typeof destValue === 'function') {
      destValue = destValue.call(src[srcKey]);
    }
  }

  return destValue;
}

function pull(src, grip, kgrip) {
  var dest;

  if (Array.isArray(src) && !kgrip) {
    dest = [];
  } else {
    dest = {};
  }

  var arrayKeys = {};

  for (var srcKey in src) {
    if (!src.hasOwnProperty(srcKey)) {
      continue;
    }

    var destKey = runGrip(src, srcKey, kgrip) || srcKey;
    var destValue = runGrip(src, srcKey, grip) || src[srcKey];

    if (dest[destKey]) {
      if (!arrayKeys[destKey]) {
        arrayKeys[destKey] = true;
        dest[destKey] = [dest[destKey]];
      }
      dest[destKey].push(destValue);
    } else {
      dest[destKey] = destValue;
    }
  }

  return dest;
}

module.exports = pull;
